meta:
  engine: 4.1.0
  version: 0.0.1
  author: n1tsu

units:
  # keys
  ks: 16
  kp: 1
  px: ks + kp + 5
  # px: 0
  qcol_stagger: 0U
  wcol_stagger: 0.66U
  ecol_stagger: 0.25U
  rcol_stagger: -0.25U
  tcol_stagger: -0.15U
  thumb_splay: 0
  mirror_splay: -20
  # mirror_splay: 0
  mirror_dist: 105

  # case
  case_edge_size: 0

  # components
  components_padding: 4
  nicenano_width: 17.78
  nicenano_height: 33
  battery_width: 12
  battery_height: 30
  niceview_width: 14
  niceview_height: 30
  battery_connector_width: 0.4U # !
  battery_connector_height: 0.8U # !
  power_width: 2.7
  power_height: 7.8
  power_button_size: 1.5
  reset_width: 4.5
  reset_height: 6.4

points:
  zones:
    matrix:
      key:
        spread: ks + kp
        tags: "keys"
      anchor.shift: [100, -100]
      columns:
        qcol:
          key:
            stagger: qcol_stagger
            column_net: D05
        wcol.key.stagger: wcol_stagger
        ecol.key.stagger: ecol_stagger
        rcol.key.stagger: rcol_stagger
        tcol.key.stagger: tcol_stagger
      rows:
        zrow.padding: ks + kp
        arow.padding: ks + kp
        qrow:
          padding: ks + kp
          row_net: D01
          mirror.row_net: D04

    thumb:
      key:
        tags: "keys"
        spread: ks+kp
        padding: ks+kp
      anchor:
        ref: matrix_rcol_zrow
        shift: [0, -ks-kp]
      columns:
        inner:
        middle.key:
          shift: [0, tcol_stagger]
        outer.key:
          shift: [0, tcol_stagger+tcol_stagger]

    unrotated:
      anchor:
        ref: matrix_rcol_zrow
        rotate: -mirror_splay
        shift: [0, 0]

    controller_center:
      anchor:
        ref: unrotated
        rotate: -90
        shift: [0.5 mirror_dist, 0]

  rotate: mirror_splay
  mirror:
    ref: matrix_rcol_zrow
    distance: mirror_dist

outlines:
  keycaps:
    - what: rectangle
      where: keys
      size: ks
      asym: both

  controller:
    - what: rectangle
      where: controller_center
      size: [nicenano_width, nicenano_height]
      # asym: both
      # adjust.rotate: controller_rotation

  plate:
    - what: polygon
      operation: stack
      fillet: 5
      points:
        - ref: matrix_qcol_qrow
          shift: [-0.5px, 0.5px]
        - ref: matrix_wcol_qrow
          shift: [-0.5px, 0.5px]
        - ref: matrix_ecol_qrow
          shift: [-0.5px, 0.5px]
        - ref: matrix_ecol_qrow
          shift: [0.5px, 0.5px]
        - ref: matrix_rcol_qrow
          shift: [0.5px, 0.5px]
        - ref: mirror_matrix_rcol_qrow
          shift: [0.5px, 0.5px]
        - ref: mirror_matrix_ecol_qrow
          shift: [0.5px, 0.5px]
        - ref: mirror_matrix_ecol_qrow
          shift: [-0.5px, 0.5px]
        - ref: mirror_matrix_wcol_qrow
          shift: [-0.5px, 0.5px]
        - ref: mirror_matrix_qcol_qrow
          shift: [-0.5px, 0.5px]
        - ref: mirror_matrix_qcol_zrow
          shift: [-0.5px, -0.5px]
        - ref: mirror_thumb_inner
          shift: [-0.5px, -0.5px]
        - ref: mirror_thumb_outer
          shift: [-0.5px, -0.5px]
        - ref: mirror_thumb_outer
          shift: [0.5px, -0.5px]
        - ref: thumb_outer
          shift: [0.5px, -0.5px]
        - ref: thumb_outer
          shift: [-0.5px, -0.5px]
        - ref: thumb_inner
          shift: [-0.5px, -0.5px]
        - ref: matrix_qcol_zrow
          shift: [-0.5px, -0.5px]

  combo:
    - operation: stack
      name: plate
    - operation: subtract
      name: keycaps

pcbs:
  main_pcb:
    outlines:
      main:
        outline: plate
    footprints:
      switch:
        what: pg1316s
        where: keys
        params:
          from: "{{column_net}}"
          to: "{{colrow}}"
      diodes_left:
        what: diode_tht_sod123
        where: /^matrix_.*|^thumb_.*/
        params:
          side: "F"
          from: "{{colrow}}"
          to: "{{row_net}}"
        adjust:
          shift: [0.3, 2.4]
      diodes_right:
        what: diode_tht_sod123
        where: /^mirror_matrix_.*|^mirror_thumb_.*/
        params:
          side: "F"
          from: "{{colrow}}"
          to: "{{row_net}}"
        adjust:
          shift: [-0.3, 2.4]
      controller_left:
        what: nicenano
        where: controller_center
        params:
          orientation: up
